<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>üõ°Ô∏è Tines Shift Dashboard</title>

<style>
:root{
  --glass-bg: rgba(255,255,255,0.16);
  --glass-border: rgba(255,255,255,0.25);
  --card-bg: rgba(255,255,255,0.18);
  --hover-bg: rgba(255,255,255,0.28);
}

*{box-sizing:border-box}

body{
  margin:0;
  min-height:100vh;
  font-family:"Segoe UI",system-ui,sans-serif;
  background:radial-gradient(circle at top,#2c5364,#0f2027 70%);
  display:flex;
  align-items:center;
  justify-content:center;
  color:#fff;
}

/* =========================
   TOP LEFT SEARCH SYSTEM
   ========================= */
.search-box{
  position:fixed;
  top:20px;
  left:24px;
  z-index:9999;
  display:flex;
  flex-direction:column;
  gap:8px;
  width:300px;
}

.search-top{
  display:flex;
  gap:8px;
}

.search-top input{
  flex:1;
  padding:10px 14px;
  border-radius:14px;
  border:none;
  font-size:13px;
}

.search-top button{
  padding:10px 14px;
  border-radius:14px;
  border:none;
  font-weight:600;
  cursor:pointer;
  background:rgba(255,255,255,0.25);
  color:#fff;
  backdrop-filter:blur(12px);
  border:1px solid rgba(255,255,255,0.4);
  transition:.25s ease;
}

.search-top button:hover{
  background:rgba(255,255,255,0.4);
}
.title{
  display:flex;
  align-items:center;
  justify-content:center;
  gap:12px;
}

.logo{
  height:36px;
  width:auto;
}

.search-modes{
  display:flex;
  gap:8px;
}

.mode-btn{
  flex:1;
  padding:6px;
  font-size:12px;
  border-radius:12px;
  border:1px solid rgba(255,255,255,0.4);
  background:rgba(255,255,255,0.15);
  color:#fff;
  cursor:pointer;
  transition:.2s ease;
}

.mode-btn.active{
  background:rgba(255,255,255,0.45);
  color:#000;
  font-weight:600;
}

/* =========================
   TI TOOL FIXED BUTTON
   ========================= */
.ti-tool{
  position:fixed;
  top:20px;
  right:24px;
  z-index:9999;
  padding:10px 16px;
  border-radius:16px;
  background:rgba(255,255,255,0.25);
  border:1px solid rgba(255,255,255,0.4);
  color:#fff;
  font-size:13px;
  font-weight:600;
  text-decoration:none;
  backdrop-filter:blur(12px);
  box-shadow:0 8px 20px rgba(0,0,0,0.35);
  transition:.25s ease;
}
.ti-tool:hover{
  background:rgba(255,255,255,0.4);
  transform:translateY(-1px);
}

/* ========================= */

.dashboard{
  width:560px;
  padding:28px;
  border-radius:24px;
  background:var(--glass-bg);
  backdrop-filter:blur(16px);
  border:1px solid var(--glass-border);
  box-shadow:0 30px 60px rgba(0,0,0,.45);
}

h2{text-align:center;margin:0 0 20px;font-weight:600}
.controls{display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:24px}
label{font-size:13px;opacity:.85;margin-bottom:6px;display:block}
input,select{width:100%;padding:10px 12px;border-radius:12px;border:none;font-size:14px}
.date-wrapper{position:relative;cursor:pointer}
.date-display{background:#fff;color:#000}
.calendar-input{position:absolute;inset:0;opacity:0;cursor:pointer}
.divider{height:1px;background:rgba(255,255,255,.3);margin:24px 0}
h3{margin:0 0 14px;text-align:center;font-weight:500}
.cards{display:grid;gap:12px}
.card{background:var(--card-bg);border-radius:16px;padding:14px 16px;transition:.2s ease}
.card:hover{background:var(--hover-bg)}
.card a{color:#fff;text-decoration:none;display:flex;align-items:center;font-size:15px}
.card a.disabled{opacity:.4;pointer-events:none;cursor:not-allowed}
.footer{margin-top:18px;text-align:center;font-size:12px;opacity:.75}
</style>
</head>

<body>

<!-- SEARCH SYSTEM -->
<div class="search-box">
  <div class="search-top">
    <input type="text" id="searchInput" placeholder="üîé Search in Tines..." 
           onkeypress="if(event.key==='Enter') searchTines()">
    <button onclick="searchTines()">Go</button>
  </div>
  <div class="search-modes">
    <button class="mode-btn active" id="globalBtn" onclick="setMode('global')">üåê Global</button>
    <button class="mode-btn" id="commentBtn" onclick="setMode('comment')">üí¨ Comment</button>
  </div>
</div>

<a class="ti-tool" href="https://osintdb.vercel.app" target="_blank">
  üïµÔ∏è TI Tool
</a>

<div class="dashboard">
 <h2 class="title">
  <img src="tines-removebg-preview.png" alt="Tines Logo" class="logo" onerror="this.style.display='none'">
  Tines Shift Dashboard
</h2>


  <div class="controls">
    <div>
      <label>üìÖ Date</label>
      <div class="date-wrapper" onclick="openCalendar()">
        <input id="dateDisplay" class="date-display" placeholder="DD-MM-YYYY" readonly>
        <input type="date" id="date" class="calendar-input" onchange="handleDate()">
      </div>
    </div>
    <div>
      <label>‚è∞ Shift</label>
      <select id="shift" onchange="generateLinks()">
        <option value="">Select shift</option>
        <option value="morning">üåÖ Morning</option>
        <option value="afternoon">üåá Afternoon</option>
        <option value="night">üåô Night</option>
      </select>
    </div>
  </div>

  <div class="divider"></div>

  <h3>üìä Shift Reporting</h3>

  <div class="cards">
    <div class="card"><a id="triggered" class="disabled" href="#" target="_blank">1Ô∏è‚É£ Total cases triggered</a></div>
    <div class="card"><a id="open" class="disabled" href="#" target="_blank">üö® Total open cases</a></div>
    <div class="card"><a id="closed" class="disabled" href="#" target="_blank">‚úÖ Closed / Handled cases</a></div>
    <div class="card"><a id="onhold" class="disabled" href="#" target="_blank">‚è∏ On Hold cases</a></div>
  </div>

  <div class="footer">‚öîÔ∏è GCC SOC India</div>
</div>

<script>

let searchMode = "global";

function setMode(mode){
  searchMode = mode;
  document.getElementById("globalBtn").classList.remove("active");
  document.getElementById("commentBtn").classList.remove("active");
  document.getElementById(mode+"Btn").classList.add("active");
}

function searchTines(){
  const query = document.getElementById("searchInput").value.trim();
  if(!query) return;

  const encoded = encodeURIComponent(query);
  let url;

  if(searchMode==="global"){
    url = `https://intezer-managed-soar.tines.com/teams/65868/cases?sort=CREATED_DESC&view=list&search=${encoded}&v=2`;
  }else{
    url = `https://intezer-managed-soar.tines.com/teams/65868/cases?sort=CREATED_DESC&view=list&filter[comment]=${encoded}&v=2`;
  }

  window.open(url,"_blank");
}

function openCalendar(){
  const d=document.getElementById("date");
  if(d.showPicker) {
    d.showPicker();
  } else {
    d.focus();
  }
}

function handleDate(){
  const dateInput = document.getElementById("date");
  const dateDisplay = document.getElementById("dateDisplay");
  
  if(!dateInput.value) return;
  
  const v = dateInput.value.split("-");
  dateDisplay.value = `${v[2]}-${v[1]}-${v[0]}`;
  
  console.log("Date selected:", dateInput.value);
  generateLinks();
}

function getUTC(date, shift){
  let s, e;
  const d = new Date(date + "T00:00:00");
  
  if(shift === "morning"){
    s = `${date}T00:30:00.000Z`;
    e = `${date}T08:30:00.000Z`;
  }
  else if(shift === "afternoon"){
    s = `${date}T08:30:00.000Z`;
    e = `${date}T16:30:00.000Z`;
  }
  else if(shift === "night"){
    s = `${date}T16:30:00.000Z`;
    d.setDate(d.getDate() + 1);
    const nextDay = d.toISOString().split("T")[0];
    e = `${nextDay}T00:30:00.000Z`;
  }
  
  console.log("Time range:", s, "to", e);
  return {s, e};
}

function enable(id, url){
  const a = document.getElementById(id);
  a.href = url;
  a.classList.remove("disabled");
  console.log(`Enabled ${id}:`, url);
}

function generateLinks(){
  const dateInput = document.getElementById("date");
  const shiftSelect = document.getElementById("shift");
  
  console.log("Generate called - Date:", dateInput.value, "Shift:", shiftSelect.value);
  
  if(!dateInput.value || !shiftSelect.value) {
    console.log("Missing date or shift");
    return;
  }

  const {s, e} = getUTC(dateInput.value, shiftSelect.value);
  const base = "https://intezer-managed-soar.tines.com/teams/65868/cases";
  
  const common = {
    sort: "RECENTLY_EDITED",
    view: "list",
    "filter[date][start]": s,
    "filter[date][end]": e,
    "filter[child_team_ids]": "[72143,72144]",
    v: "2"
  };

  // Total cases triggered (all cases in time range)
  const triggeredUrl = `${base}?${new URLSearchParams(common).toString()}`;
  enable("triggered", triggeredUrl);

  // Total open cases (status = OPEN with specific substatuses)
  const openParams = {
    ...common,
    "filter[status]": "OPEN",
    "filter[subStatus]": "escalated,in_progress,on_hold"
  };
  const openUrl = `${base}?${new URLSearchParams(openParams).toString()}`;
  enable("open", openUrl);

  // Closed / Handled cases (status = CLOSED with all closure substatuses)
  const closedParams = {
    ...common,
    "filter[status]": "CLOSED",
    "filter[subStatus]": "done,canceled,automatically_closed,true_positive,benign_positive_suspicious_expected,false_positive,false_negative_missed_detection,duplicate"
  };
  const closedUrl = `${base}?${new URLSearchParams(closedParams).toString()}`;
  enable("closed", closedUrl);

  // On Hold cases (substatus = on_hold only)
  const onholdParams = {
    ...common,
    "filter[subStatus]": "on_hold"
  };
  const onholdUrl = `${base}?${new URLSearchParams(onholdParams).toString()}`;
  enable("onhold", onholdUrl);
  
  console.log("All links generated successfully");
}
</script>

</body>
</html>
